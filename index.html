<!doctype html>
<html lang="ja" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ“ãƒƒãƒˆã¨é›»çƒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&amp;family=Noto+Sans+JP:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    .font-display {
      font-family: 'Quicksand', sans-serif;
    }
    
    .font-body {
      font-family: 'Noto Sans JP', sans-serif;
    }
    
    /* Bulb glow effect */
    .bulb-on {
      filter: drop-shadow(0 0 15px #fbbf24) drop-shadow(0 0 30px #f59e0b);
    }
    
    /* Switch styling */
    .switch-track {
      transition: background-color 0.3s ease;
    }
    
    .switch-thumb {
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .switch-on .switch-thumb {
      transform: translateX(24px);
    }
    
    /* Pulse animation for new bit */
    @keyframes pulse-grow {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .pulse-in {
      animation: pulse-grow 0.4s ease-out;
    }
    
    /* Info card animation */
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-up {
      animation: slideUp 0.5s ease-out;
    }
    
    /* Bulb swing animation */
    @keyframes swing {
      0%, 100% { transform: rotate(-2deg); }
      50% { transform: rotate(2deg); }
    }
    
    .bulb-swing {
      animation: swing 2s ease-in-out infinite;
      transform-origin: top center;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full font-body">
  <div id="app" class="h-full w-full overflow-auto" style="background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);"><!-- Header -->
   <header class="text-center pt-6 pb-4 px-4">
    <h1 id="game-title" class="font-display text-2xl md:text-3xl font-bold text-amber-400 mb-2">ğŸ’¡ ãƒ“ãƒƒãƒˆã¨é›»çƒ</h1>
    <p id="instruction-text" class="text-slate-400 text-sm md:text-base">é›»çƒãŒå¢—ãˆã‚‹ã¨ã€å¿…è¦ãªã‚¹ã‚¤ãƒƒãƒï¼ˆãƒ“ãƒƒãƒˆï¼‰ã‚‚å¢—ãˆã‚‹ï¼</p>
   </header>
   <main class="max-w-3xl mx-auto px-4 pb-8"><!-- Bulb Count Control -->
    <div class="bg-slate-800/60 rounded-2xl p-5 mb-6 border border-slate-700 slide-up">
     <div class="flex items-center justify-between flex-wrap gap-4">
      <div>
       <div class="text-slate-300 font-medium mb-1">
        é›»çƒã®æ•°
       </div>
       <div class="text-slate-500 text-sm">
        å¢—ã‚„ã™ã¨å¿…è¦ãªãƒ“ãƒƒãƒˆã‚‚å¢—ãˆã‚‹ã‚ˆ
       </div>
      </div>
      <div class="flex items-center gap-3"><button id="decrease-bulbs" class="w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 text-white text-xl font-bold transition-all flex items-center justify-center border border-slate-600"> âˆ’ </button> <span id="bulb-count" class="font-display text-3xl text-amber-400 font-bold w-12 text-center">2</span> <button id="increase-bulbs" class="w-10 h-10 rounded-full bg-amber-500 hover:bg-amber-400 text-white text-xl font-bold transition-all flex items-center justify-center"> + </button>
      </div>
     </div>
    </div><!-- Info Panel -->
    <div id="info-panel" class="bg-gradient-to-r from-indigo-900/50 to-purple-900/50 rounded-2xl p-5 mb-6 border border-indigo-700/50 slide-up">
     <div class="grid grid-cols-3 gap-4 text-center">
      <div>
       <div class="text-indigo-300 text-xs mb-1">
        é›»çƒã®æ•°
       </div>
       <div id="info-bulbs" class="font-display text-2xl text-white font-bold">
        2
       </div>
      </div>
      <div>
       <div class="text-purple-300 text-xs mb-1">
        å¿…è¦ãªãƒ“ãƒƒãƒˆæ•°
       </div>
       <div id="info-bits" class="font-display text-2xl text-amber-400 font-bold">
        1
       </div>
      </div>
      <div>
       <div class="text-pink-300 text-xs mb-1">
        è¡¨ç¾ã§ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³
       </div>
       <div id="info-patterns" class="font-display text-2xl text-emerald-400 font-bold">
        2
       </div>
      </div>
     </div>
    </div><!-- Bulbs Display -->
    <div class="bg-slate-900/50 rounded-2xl p-6 mb-6 border border-slate-700">
     <div class="text-center text-slate-400 text-sm mb-4">
      ç¾åœ¨ã®é›»çƒã®çŠ¶æ…‹
     </div>
     <div id="bulbs-container" class="flex justify-center items-end gap-4 flex-wrap min-h-24"><!-- Bulbs will be generated here -->
     </div>
    </div>
    <div id="emoji-container" class="bg-slate-800/60 rounded-2xl p-6 mb-6 border border-slate-700 text-center hidden transition-all">
      <div class="text-slate-400 text-sm mb-2">
       çµ„ã¿åˆã‚ã›ãŒè¡¨ã™æƒ…å ±ï¼ˆãƒ‡ãƒ¼ã‚¿ï¼‰
      </div>
      <div id="emoji-result" class="text-7xl md:text-8xl transition-all filter drop-shadow-lg" style="min-height: 100px; display: flex; align-items: center; justify-content: center;">
       </div>
      <div id="emoji-label" class="text-amber-400 font-display font-bold mt-2 text-xl">
       </div>
    </div>
    <!-- Switches (Bits) -->
    <div class="bg-slate-800/60 rounded-2xl p-5 mb-6 border border-slate-700">
     <div class="text-center text-slate-400 text-sm mb-4">
      ã‚¹ã‚¤ãƒƒãƒï¼ˆãƒ“ãƒƒãƒˆï¼‰<span id="switch-count-label" class="text-amber-400 font-bold">1</span>å€‹
     </div>
     <div id="switches-container" class="flex justify-center items-center gap-4 flex-wrap"><!-- Switches will be generated here -->
     </div><!-- Binary representation -->
     <div class="mt-4 text-center"><span class="text-slate-500 text-sm">2é€²æ•°: </span> <span id="binary-display" class="font-display text-lg text-cyan-400">0</span> <span class="text-slate-500 text-sm ml-3">= é›»çƒãƒ‘ã‚¿ãƒ¼ãƒ³ </span> <span id="pattern-number" class="font-display text-lg text-emerald-400">#1</span> <span class="text-slate-500 text-sm"> / </span> <span id="total-patterns" class="font-display text-lg text-slate-400">2</span>
     </div>
    </div><!-- Explanation Card -->
    <div id="explanation" class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-5 border border-slate-700">
     <h3 class="text-amber-400 font-bold mb-3 flex items-center gap-2"><span>ğŸ“š</span> ãªãœãƒ“ãƒƒãƒˆãŒå¢—ãˆã‚‹ã®ï¼Ÿ</h3>
     <div id="explanation-text" class="text-slate-300 text-sm leading-relaxed space-y-2">
      <p>ğŸ”¹ <strong class="text-amber-300">1ãƒ“ãƒƒãƒˆ</strong>ã§ã¯ã€0ã¨1ã®<strong class="text-emerald-400">2é€šã‚Š</strong>ã‚’è¡¨ç¾ã§ãã¾ã™</p>
      <p>ğŸ”¹ é›»çƒãŒ<strong class="text-amber-300">2å€‹</strong>ãªã‚‰ã€ã€Œä¸¡æ–¹OFFã€ã€Œ1å€‹ã ã‘ONã€ãªã©<strong class="text-emerald-400">2é€šã‚Šä»¥ä¸Š</strong>ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¿…è¦ï¼</p>
      <p class="text-slate-400 pt-2 border-t border-slate-700 mt-3">ğŸ’¡ é›»çƒã‚’å¢—ã‚„ã—ã¦ã€ãƒ“ãƒƒãƒˆæ•°ã®å¤‰åŒ–ã‚’è¦³å¯Ÿã—ã¦ã¿ã‚ˆã†ï¼</p>
     </div>
    </div><!-- Quick Reference -->
    <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-3 text-center text-sm">
     <div class="bg-slate-800/40 rounded-xl p-3 border border-slate-700">
      <div class="text-slate-400">
       1ãƒ“ãƒƒãƒˆ
      </div>
      <div class="text-amber-400 font-display font-bold">
       2ãƒ‘ã‚¿ãƒ¼ãƒ³
      </div>
     </div>
     <div class="bg-slate-800/40 rounded-xl p-3 border border-slate-700">
      <div class="text-slate-400">
       2ãƒ“ãƒƒãƒˆ
      </div>
      <div class="text-amber-400 font-display font-bold">
       4ãƒ‘ã‚¿ãƒ¼ãƒ³
      </div>
     </div>
     <div class="bg-slate-800/40 rounded-xl p-3 border border-slate-700">
      <div class="text-slate-400">
       3ãƒ“ãƒƒãƒˆ
      </div>
      <div class="text-amber-400 font-display font-bold">
       8ãƒ‘ã‚¿ãƒ¼ãƒ³
      </div>
     </div>
     <div class="bg-slate-800/40 rounded-xl p-3 border border-slate-700">
      <div class="text-slate-400">
       4ãƒ“ãƒƒãƒˆ
      </div>
      <div class="text-amber-400 font-display font-bold">
       16ãƒ‘ã‚¿ãƒ¼ãƒ³
      </div>
     </div>
    </div>
   </main>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      game_title: 'ğŸ’¡ ãƒ“ãƒƒãƒˆã¨é›»çƒ',
      instruction_text: 'é›»çƒãŒå¢—ãˆã‚‹ã¨ã€å¿…è¦ãªã‚¹ã‚¤ãƒƒãƒï¼ˆãƒ“ãƒƒãƒˆï¼‰ã‚‚å¢—ãˆã‚‹ï¼',
      primary_color: '#fbbf24',
      secondary_color: '#1e293b',
      text_color: '#e2e8f0'
    };

    // State
    let bulbCount = 2;
    let bits = [0];
    // --- ã“ã“ã‹ã‚‰è¿½åŠ  ---
  // Emoji Mappings
  // 2ãƒ“ãƒƒãƒˆç”¨ï¼ˆå¤©æ°—ï¼‰: 00, 01, 10, 11 ã«å¯¾å¿œ
  const emojiMap2Bit = [
    { icon: 'â˜€ï¸', label: 'æ™´ã‚Œ (Sun)' },
    { icon: 'â˜ï¸', label: 'ãã‚‚ã‚Š (Cloud)' },
    { icon: 'â˜”', label: 'é›¨ (Rain)' },
    { icon: 'â˜ƒï¸', label: 'é›ª (Snow)' }
  ];

  //3ãƒ“ãƒƒãƒˆç”¨ï¼ˆè™¹ã¨ãã®è‰²ï¼‰:000~111ã«å¯¾å¿œ
  const emojiMap3Bit = [
  { icon: 'ğŸ”´', label: 'èµ¤' }, { icon: 'ğŸŸ ', label: 'æ©™' },
  { icon: 'ğŸŸ¡', label: 'é»„' }, { icon: 'ğŸŸ¢', label: 'ç·‘' },
  { icon: 'ğŸ”µ', label: 'é’' }, { icon: 'ğŸª»', label: 'è—' },
  { icon: 'ğŸŸ£', label: 'ç´«' }, { icon: 'ğŸŒˆ', label: 'è™¹' }
  ];
 
  // 4ãƒ“ãƒƒãƒˆç”¨ï¼ˆã„ã‚ã„ã‚ï¼‰: 0000 ï½ 1111 ã«å¯¾å¿œ (16ç¨®é¡)
  const emojiMap4Bit = [
    { icon: 'ğŸ¶', label: 'ã„ã¬' }, { icon: 'ğŸ±', label: 'ã­ã“' }, { icon: 'ğŸ­', label: 'ã­ãšã¿' }, { icon: 'ğŸ¹', label: 'ãƒãƒ ã‚¹ã‚¿ãƒ¼' },
    { icon: 'ğŸ', label: 'ã‚Šã‚“ã”' }, { icon: 'ğŸŒ', label: 'ãƒãƒŠãƒŠ' }, { icon: 'ğŸ‡', label: 'ã¶ã©ã†' }, { icon: 'ğŸ‰', label: 'ã™ã„ã‹' },
    { icon: 'âš½', label: 'ã‚µãƒƒã‚«ãƒ¼' }, { icon: 'ğŸ€', label: 'ãƒã‚¹ã‚±' }, { icon: 'âš¾', label: 'é‡çƒ' }, { icon: 'ğŸ¾', label: 'ãƒ†ãƒ‹ã‚¹' },
    { icon: 'ğŸš—', label: 'ãã‚‹ã¾' }, { icon: 'âœˆï¸', label: 'ã²ã“ã†ã' }, { icon: 'ğŸš€', label: 'ãƒ­ã‚±ãƒƒãƒˆ' }, { icon: 'ğŸ›¸', label: 'UFO' }
  ];

  //5ãƒ“ãƒƒãƒˆç”¨ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã¨è¨˜å·ï¼‰:00000~11111ã«å¯¾å¿œ
  const emojiMap5Bit = [];
  const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ?!@#&*"; // 32æ–‡å­—åˆ†
   for (let char of alphabet) {
  emojiMap5Bit.push({ icon: 'ğŸ”¡', label: char });
  }
  // DOM Elements for Emoji
  const emojiContainer = document.getElementById('emoji-container');
  const emojiResult = document.getElementById('emoji-result');
  const emojiLabel = document.getElementById('emoji-label');
// --- ã“ã“ã¾ã§è¿½åŠ  ---

    // DOM Elements
    const bulbsContainer = document.getElementById('bulbs-container');
    const switchesContainer = document.getElementById('switches-container');
    const infoBulbs = document.getElementById('info-bulbs');
    const infoBits = document.getElementById('info-bits');
    const infoPatterns = document.getElementById('info-patterns');
    const binaryDisplay = document.getElementById('binary-display');
    const patternNumber = document.getElementById('pattern-number');
    const totalPatterns = document.getElementById('total-patterns');
    const switchCountLabel = document.getElementById('switch-count-label');
    const explanationText = document.getElementById('explanation-text');
    const bulbCountDisplay = document.getElementById('bulb-count');
    const decreaseBtn = document.getElementById('decrease-bulbs');
    const increaseBtn = document.getElementById('increase-bulbs');

    // Calculate required bits for n bulbs (each bulb can be on/off = 2^bulbs patterns, need ceil(log2(patterns)) bits... but actually we need bulbCount bits to control each bulb individually)
    // Actually: to control N bulbs independently, we need N bits (1 bit per bulb)
    function getRequiredBits(numBulbs) {
      return numBulbs;
    }

    // Create bulb SVG
    function createBulbSVG(isOn, index) {
      const bulbDiv = document.createElement('div');
      bulbDiv.className = `flex flex-col items-center pulse-in bulb-swing`;
      bulbDiv.style.animationDelay = `${index * 0.1}s`;
      
      bulbDiv.innerHTML = `
        <svg width="50" height="70" viewBox="0 0 50 70" class="${isOn ? 'bulb-on' : ''}">
          <!-- Wire -->
          <line x1="25" y1="0" x2="25" y2="15" stroke="#666" stroke-width="2"/>
          
          <!-- Bulb base -->
          <rect x="18" y="50" width="14" height="8" rx="1" fill="#888"/>
          <rect x="20" y="55" width="10" height="4" rx="1" fill="#666"/>
          
          <!-- Bulb glass -->
          <ellipse cx="25" cy="35" rx="18" ry="20" fill="${isOn ? '#fef3c7' : '#374151'}" stroke="${isOn ? '#fcd34d' : '#4b5563'}" stroke-width="2"/>
          
          <!-- Filament -->
          <path d="M20 35 Q22 30 25 35 Q28 40 30 35" stroke="${isOn ? '#f59e0b' : '#6b7280'}" stroke-width="2" fill="none"/>
          
          ${isOn ? `
          <!-- Glow effect -->
          <ellipse cx="25" cy="35" rx="15" ry="17" fill="url(#glow${index})" opacity="0.6"/>
          <defs>
            <radialGradient id="glow${index}">
              <stop offset="0%" stop-color="#fef3c7"/>
              <stop offset="100%" stop-color="transparent"/>
            </radialGradient>
          </defs>
          ` : ''}
        </svg>
        <span class="text-xs mt-1 ${isOn ? 'text-amber-400' : 'text-slate-500'} font-display">${isOn ? 'ON' : 'OFF'}</span>
      `;
      
      return bulbDiv;
    }

    // Create switch element
    function createSwitch(index, isOn) {
      const switchDiv = document.createElement('div');
      switchDiv.className = 'flex flex-col items-center pulse-in';
      switchDiv.style.animationDelay = `${index * 0.05}s`;
      
      const track = document.createElement('button');
      track.className = `switch-track w-14 h-8 rounded-full relative cursor-pointer ${isOn ? 'bg-amber-500 switch-on' : 'bg-slate-600'}`;
      track.setAttribute('role', 'switch');
      track.setAttribute('aria-checked', isOn);
      track.setAttribute('aria-label', `ãƒ“ãƒƒãƒˆ${index + 1}: ${isOn ? 'ã‚ªãƒ³' : 'ã‚ªãƒ•'}`);
      
      const thumb = document.createElement('div');
      thumb.className = `switch-thumb absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md`;
      if (isOn) thumb.style.transform = 'translateX(24px)';
      
      track.appendChild(thumb);
      
      track.addEventListener('click', () => toggleBit(index));
      
      const label = document.createElement('span');
      label.className = `text-xs mt-2 font-display ${isOn ? 'text-amber-400' : 'text-slate-500'}`;
      label.textContent = `Bit ${index + 1}`;
      
      const valueLabel = document.createElement('span');
      valueLabel.className = `text-lg font-bold font-display ${isOn ? 'text-white' : 'text-slate-600'}`;
      valueLabel.textContent = isOn ? '1' : '0';
      
      switchDiv.appendChild(track);
      switchDiv.appendChild(valueLabel);
      switchDiv.appendChild(label);
      
      return switchDiv;
    }

    // Toggle bit
    function toggleBit(index) {
      bits[index] = bits[index] ? 0 : 1;
      render();
    }
// --- ã“ã“ã«è¿½åŠ  ---
    // Helper to trigger animation on emoji change
    function triggerEmojiAnimation() {
      // ä¸€åº¦ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã¦å¼·åˆ¶çš„ã«å†æç”»ã•ã›ã‚‹ã“ã¨ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
      emojiResult.classList.remove('pulse-in');
      void emojiResult.offsetWidth; // Trigger reflow
      emojiResult.classList.add('pulse-in');
    }
    // Update explanation based on current state
    function updateExplanation() {
      const numBits = bits.length;
      const maxPatterns = Math.pow(2, numBits);
      
      let html = '';
      
      if (numBits === 1) {
        html = `
          <p>ğŸ”¹ <strong class="text-amber-300">1ãƒ“ãƒƒãƒˆ</strong>ã§ã¯ã€0ã¨1ã®<strong class="text-emerald-400">2é€šã‚Š</strong>ã‚’è¡¨ç¾</p>
          <p>ğŸ”¹ é›»çƒ<strong class="text-amber-300">1å€‹</strong>ã®ã€ŒON/OFFã€ã‚’åˆ¶å¾¡ã§ãã¾ã™</p>
          <p class="text-slate-400 pt-2 border-t border-slate-700 mt-3">ğŸ’¡ é›»çƒã‚’å¢—ã‚„ã—ã¦ã€ãƒ“ãƒƒãƒˆæ•°ã®å¤‰åŒ–ã‚’è¦³å¯Ÿã—ã¦ã¿ã‚ˆã†ï¼</p>
        `;
      } else if (numBits === 2) {
        html = `
          <p>ğŸ”¹ <strong class="text-amber-300">2ãƒ“ãƒƒãƒˆ</strong>ã§ã¯<strong class="text-emerald-400">4é€šã‚Š</strong>ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ00, 01, 10, 11ï¼‰</p>
          <p>ğŸ”¹ å„ãƒ“ãƒƒãƒˆãŒ1ã¤ã®é›»çƒã‚’æ‹…å½“ã—ã¦ã„ã¾ã™</p>
          <p class="text-slate-400 pt-2 border-t border-slate-700 mt-3">ğŸ’¡ ãƒ“ãƒƒãƒˆæ•°ãŒ1å¢—ãˆã‚‹ã¨ã€ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ã¯<strong class="text-amber-300">2å€</strong>ã«ï¼</p>
        `;
      } else if (numBits === 3) {
        html = `
          <p>ğŸ”¹ <strong class="text-amber-300">3ãƒ“ãƒƒãƒˆ</strong>ã§<strong class="text-emerald-400">8é€šã‚Š</strong>ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼</p>
          <p>ğŸ”¹ 000, 001, 010, 011, 100, 101, 110, 111</p>
          <p class="text-slate-400 pt-2 border-t border-slate-700 mt-3">ğŸ’¡ 2ã®3ä¹— = 8ãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¾ã§ãã‚‹ï¼</p>
        `;
      } else if (numBits === 4) {
        html = `
          <p>ğŸ”¹ <strong class="text-amber-300">4ãƒ“ãƒƒãƒˆ</strong>ã§<strong class="text-emerald-400">16é€šã‚Š</strong>ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼</p>
          <p>ğŸ”¹ ã“ã‚Œã¯16é€²æ•°ã®1æ¡ï¼ˆ0ã€œFï¼‰ã¨åŒã˜ã§ã™</p>
          <p class="text-slate-400 pt-2 border-t border-slate-700 mt-3">ğŸ’¡ å€ã€…ã§å¢—ãˆã¦ã„ãã®ãŒã‚ã‹ã‚Šã¾ã™ã­ï¼</p>
        `;
      } else {
        html = `
          <p>ğŸ”¹ <strong class="text-amber-300">${numBits}ãƒ“ãƒƒãƒˆ</strong>ã§<strong class="text-emerald-400">${maxPatterns}é€šã‚Š</strong>ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼</p>
          <p>ğŸ”¹ è¨ˆç®—å¼: 2<sup>${numBits}</sup> = ${maxPatterns}</p>
          <p class="text-slate-400 pt-2 border-t border-slate-700 mt-3">ğŸ’¡ ãƒ‡ãƒ¼ã‚¿é‡ãŒå¢—ãˆã‚‹ã¨ã€å¿…è¦ãªãƒ“ãƒƒãƒˆæ•°ã‚‚å¢—ãˆã‚‹ï¼</p>
        `;
      }
      
      explanationText.innerHTML = html;
    }

    // Main render function
    function render() {
      const requiredBits = getRequiredBits(bulbCount);
      
      // Adjust bits array if needed
      while (bits.length < requiredBits) {
        bits.push(0);
      }
      while (bits.length > requiredBits) {
        bits.pop();
      }
      
      // Update info panel
      infoBulbs.textContent = bulbCount;
      infoBits.textContent = requiredBits;
      infoPatterns.textContent = Math.pow(2, requiredBits);
      
      // Render bulbs
      bulbsContainer.innerHTML = '';
      for (let i = 0; i < bulbCount; i++) {
        const isOn = bits[i] === 1;
        bulbsContainer.appendChild(createBulbSVG(isOn, i));
      }
      
      // Render switches
      switchesContainer.innerHTML = '';
      for (let i = 0; i < requiredBits; i++) {
        switchesContainer.appendChild(createSwitch(i, bits[i] === 1));
      }
      
      // Update binary display
      const binaryStr = bits.join('');
      binaryDisplay.textContent = binaryStr;
      
      // Calculate current pattern number (binary to decimal + 1)
      const patternNum = bits.reduce((acc, bit, i) => acc + bit * Math.pow(2, bits.length - 1 - i), 0) + 1;
      patternNumber.textContent = `#${patternNum}`;
      totalPatterns.textContent = Math.pow(2, requiredBits);
      
      // Update switch count label
      switchCountLabel.textContent = requiredBits;
      
      // Update bulb count display
      bulbCountDisplay.textContent = bulbCount;
      
      // Update explanation
      updateExplanation();
      // --- ã“ã“ã‹ã‚‰è¿½åŠ  ---
      // Update Emoji Display based on bulb count
      // ç¾åœ¨ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ•°å€¤ï¼ˆ0ã‹ã‚‰å§‹ã¾ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰ã‚’è¨ˆç®—
      const currentIndex = patternNum - 1;

      if (bulbCount === 2) {
        // 2ãƒ“ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ï¼šå¤©æ°—ã‚’è¡¨ç¤º
        emojiContainer.classList.remove('hidden'); // ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
        emojiResult.textContent = emojiMap2Bit[currentIndex].icon;
        emojiLabel.textContent = emojiMap2Bit[currentIndex].label;
        triggerEmojiAnimation(); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ

      } else if (bulbCount === 4) {
        // 4ãƒ“ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ï¼š16ç¨®é¡ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º
        emojiContainer.classList.remove('hidden'); // ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
        emojiResult.textContent = emojiMap4Bit[currentIndex].icon;
        emojiLabel.textContent = emojiMap4Bit[currentIndex].label;
        triggerEmojiAnimation(); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ

      } else {
        // ãã‚Œä»¥å¤–ã®ãƒ“ãƒƒãƒˆæ•°ã§ã¯éš ã™
        emojiContainer.classList.add('hidden');
      }
      
      // Update button states
      decreaseBtn.disabled = bulbCount <= 1;
      decreaseBtn.className = `w-10 h-10 rounded-full ${bulbCount <= 1 ? 'bg-slate-800 text-slate-600 cursor-not-allowed' : 'bg-slate-700 hover:bg-slate-600 text-white'} text-xl font-bold transition-all flex items-center justify-center border border-slate-600`;
      
      increaseBtn.disabled = bulbCount >= 8;
      increaseBtn.className = `w-10 h-10 rounded-full ${bulbCount >= 8 ? 'bg-slate-600 text-slate-400 cursor-not-allowed' : 'bg-amber-500 hover:bg-amber-400 text-white'} text-xl font-bold transition-all flex items-center justify-center`;
    }

    // Event listeners
    decreaseBtn.addEventListener('click', () => {
      if (bulbCount > 1) {
        bulbCount--;
        render();
      }
    });

    increaseBtn.addEventListener('click', () => {
      if (bulbCount < 8) {
        bulbCount++;
        render();
      }
    });

    // Config change handler
    async function onConfigChange(config) {
      const title = config.game_title || defaultConfig.game_title;
      const instruction = config.instruction_text || defaultConfig.instruction_text;
      
      document.getElementById('game-title').textContent = title;
      document.getElementById('instruction-text').textContent = instruction;
    }

    // Map to capabilities
    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    // Map to edit panel values
    function mapToEditPanelValues(config) {
      return new Map([
        ['game_title', config.game_title || defaultConfig.game_title],
        ['instruction_text', config.instruction_text || defaultConfig.instruction_text]
      ]);
    }

    // Initialize
    render();

    // Initialize SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ba9c0b3823b3bb3',t:'MTc2Nzg1NDk0My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
